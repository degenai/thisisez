<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA COMBINATOR - Pentalectic Engine</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Combinator Specific Styles */
        .combinator-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .panel {
            border: 1px solid var(--c-border);
            background: rgba(0, 20, 0, 0.8);
            padding: 15px;
        }

        .panel-header {
            border-bottom: 1px solid var(--c-border);
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--c-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Leaderboard */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .leaderboard-table th {
            text-align: left;
            color: #666;
            padding: 5px;
            border-bottom: 1px solid #333;
        }

        .leaderboard-table td {
            padding: 8px 5px;
            border-bottom: 1px solid #111;
        }

        .rank-col {
            color: var(--c-primary);
            font-weight: bold;
            width: 30px;
            vertical-align: top;
        }

        .asset-col {
            color: #fff;
            font-weight: bold;
            width: 120px;
            vertical-align: top;
        }

        .thesis-col,
        .antithesis-col {
            padding: 10px;
            vertical-align: top;
            width: 40%;
            border-left: 1px solid #333;
        }

        .d-score {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .d-text {
            color: #aaa;
            font-style: italic;
            font-size: 12px;
            line-height: 1.4;
        }

        /* Pentalectic Visualizer */
        .pentalectic-viz {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 20px;
            background: #000;
            border: 1px solid #333;
        }

        .dialectic-bar {
            flex-grow: 1;
            height: 20px;
            background: #333;
            margin: 0 20px;
            position: relative;
            overflow: hidden;
        }

        .dialectic-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--c-fear) 0%, var(--c-greed) 100%);
            width: 50%;
            /* Dynamic */
            transition: width 0.5s ease;
        }

        .dialectic-marker {
            position: absolute;
            top: -5px;
            bottom: -5px;
            width: 2px;
            background: #fff;
            left: 50%;
            /* Dynamic */
            z-index: 10;
            box-shadow: 0 0 10px #fff;
        }

        .d-label {
            font-weight: bold;
            font-size: 18px;
        }

        .d-fear {
            color: var(--c-fear);
        }

        .d-greed {
            color: var(--c-greed);
        }

        /* Heatmap */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 5px;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: #000;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
            border-color: #fff;
        }

        .footer-trademark {
            margin-top: 50px;
            text-align: center;
            font-size: 10px;
            color: #444;
            font-family: 'Courier New', monospace;
            border-top: 1px solid #111;
            padding-top: 20px;
        }

        .load-btn {
            background: var(--c-primary);
            color: #000;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-weight: bold;
            font-family: monospace;
            margin-bottom: 20px;
        }

        .load-btn:hover {
            background: #fff;
        }

        /* Temporal Graph */
        .temporal-graph {
            display: flex;
            gap: 2px;
            height: 40px;
            align-items: flex-end;
            margin-bottom: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .t-block {
            flex: 1;
            min-width: 5px;
            background: #111;
            border-top: 1px solid #333;
            position: relative;
        }

        .t-block:hover::after {
            content: attr(data-date) " (" attr(data-count) ")";
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            border: 1px solid #fff;
            padding: 2px 5px;
            font-size: 10px;
            white-space: nowrap;
            z-index: 100;
        }

        .t-gap {
            background: repeating-linear-gradient(45deg,
                    #220000,
                    #220000 2px,
                    #000 2px,
                    #000 4px);
        }

        .temporal-legend {
            font-size: 10px;
            display: flex;
            gap: 15px;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <a href="aura_farmer.html" class="back-link">← Return to Aura Farmer</a>

    <div id="terminal">
        <pre class="ascii-art">
  ___ ___  __  __ ___ ___ _  _   _ _____ ___  ___ 
 / __/ _ \|  \/  | _ )_ _| \| | /_\_   _/ _ \| _ \
| (_| (_) | |\/| | _ \| || .` |/ _ \| || (_) |   /
 \___\___/|_|  |_|___/___|_|\_/_/ \_\_| \___/|_|_\
        </pre>

        <div class="header">
            [!] SYSTEM: COMBINATOR ENGINE v1.0
            [!] MODE: PENTALECTIC AGGREGATION
        </div>

        <button id="refresh-btn" class="load-btn">[↻] REFRESH INTELLIGENCE</button>

        <!-- PENTALECTIC VISUALIZER -->
        <div class="panel">
            <div class="panel-header">:: DIALECTICAL TENSION (MARKET DRIVE) ::</div>
            <div class="pentalectic-viz">
                <span class="d-label d-fear">FEAR</span>
                <div class="dialectic-bar">
                    <div class="dialectic-fill" id="dialectic-fill"></div>
                    <div class="dialectic-marker" id="dialectic-marker"></div>
                </div>
                <span class="d-label d-greed">GREED</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                <span>TOTAL FEAR: <span id="total-fear" class="d-fear">0</span></span>
                <span>TOTAL GREED: <span id="total-greed" class="d-greed">0</span></span>
            </div>
        </div>

        <!-- TEMPORAL DENSITY GRAPH -->
        <div class="panel">
            <div class="panel-header">:: TEMPORAL COVERAGE (DATA DENSITY) ::</div>
            <div id="temporal-graph" class="temporal-graph">
                <!-- Injected JS -->
            </div>
            <div class="temporal-legend">
                <span style="color: #444;">[ ] NO DATA</span>
                <span style="color: #0f0;">[■] HIGH DENSITY</span>
            </div>
        </div>

        <div class="combinator-grid">
            <!-- LEADERBOARD -->
            <div class="panel">
                <div class="panel-header">:: IDEOLOGY LEADERBOARD ::</div>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th class="rank-col">#</th>
                            <th class="asset-col">ASSET</th>
                            <th class="thesis-col">THESIS (DOMINANT)</th>
                            <th class="antithesis-col">ANTITHESIS (COUNTER)</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <!-- Injected JS -->
                    </tbody>
                </table>
            </div>

            <!-- HEATMAP & QUALITY -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <div class="panel">
                    <div class="panel-header">:: SENTIMENT HEATMAP ::</div>
                    <div class="heatmap-grid" id="heatmap-container">
                        <!-- Injected JS -->
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">:: QUALITY TRINITY ::</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <div style="color: #0ff;">AVG IQ: <span id="avg-iq">0</span></div>
                        <div style="color: #f0f;">AVG SCHIZO: <span id="avg-schizo">0</span></div>
                        <div style="color: #888;">AVG SHILL: <span id="avg-shill">0</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-trademark">
            PENTALECTIC GARBAGE EATING OPERATION™<br>
            EST. 2025 // NO REFUNDS
        </div>
    </div>

    <script>
        // DOM Elements
        const leaderboardBody = document.getElementById('leaderboard-body');
        const heatmapContainer = document.getElementById('heatmap-container');
        const dialecticFill = document.getElementById('dialectic-fill');
        const dialecticMarker = document.getElementById('dialectic-marker');
        const totalFearEl = document.getElementById('total-fear');
        const totalGreedEl = document.getElementById('total-greed');
        const avgIqEl = document.getElementById('avg-iq');
        const avgSchizoEl = document.getElementById('avg-schizo');
        const avgShillEl = document.getElementById('avg-shill');
        const refreshBtn = document.getElementById('refresh-btn');

        // Load Data
        
window.addEventListener('DOMContentLoaded', () => {
    const data = [{"id": "thread_0_0", "timestamp": "2025-11-23T16:40:43.716077", "subject": "Day 1 Thread 0", "url": "https://boards.4channel.org/biz/", "replies": 10, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_0_1", "timestamp": "2025-11-23T16:40:43.716077", "subject": "Day 1 Thread 1", "url": "https://boards.4channel.org/biz/", "replies": 11, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_0_2", "timestamp": "2025-11-23T16:40:43.716077", "subject": "Day 1 Thread 2", "url": "https://boards.4channel.org/biz/", "replies": 12, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_0_3", "timestamp": "2025-11-23T16:40:43.716077", "subject": "Day 1 Thread 3", "url": "https://boards.4channel.org/biz/", "replies": 13, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_0_4", "timestamp": "2025-11-23T16:40:43.716077", "subject": "Day 1 Thread 4", "url": "https://boards.4channel.org/biz/", "replies": 14, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_0", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 0", "url": "https://boards.4channel.org/biz/", "replies": 10, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_1", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 1", "url": "https://boards.4channel.org/biz/", "replies": 11, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_2", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 2", "url": "https://boards.4channel.org/biz/", "replies": 12, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_3", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 3", "url": "https://boards.4channel.org/biz/", "replies": 13, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_4", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 4", "url": "https://boards.4channel.org/biz/", "replies": 14, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_5", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 5", "url": "https://boards.4channel.org/biz/", "replies": 15, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_6", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 6", "url": "https://boards.4channel.org/biz/", "replies": 16, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_7", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 7", "url": "https://boards.4channel.org/biz/", "replies": 17, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_8", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 8", "url": "https://boards.4channel.org/biz/", "replies": 18, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_2_9", "timestamp": "2025-11-21T16:40:43.716077", "subject": "Day 3 Thread 9", "url": "https://boards.4channel.org/biz/", "replies": 19, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 60, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BULLISH"}]}, {"id": "thread_3_0", "timestamp": "2025-11-20T16:40:43.716077", "subject": "Day 4 Thread 0", "url": "https://boards.4channel.org/biz/", "replies": 10, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 40, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BEARISH"}]}, {"id": "thread_3_1", "timestamp": "2025-11-20T16:40:43.716077", "subject": "Day 4 Thread 1", "url": "https://boards.4channel.org/biz/", "replies": 11, "gestalt_summary": "Mock data for verification.", "radar": {"GREED": 40, "FEAR": 50, "IQ": 50, "SCHIZO": 50, "SHILL": 50}, "keywords": ["MOCK"], "assets": [{"name": "BITCOIN", "narrative": "Mock narrative", "sentiment": "BEARISH"}]}];
    console.log("VERIFICATION MODE: MOCK DATA LOADED");
    processCombinator(data);
    renderTemporalGraph(data);
    alert("VERIFICATION MODE: MOCK DATA LOADED");
});


        refreshBtn.addEventListener('click', () => {
            loadAndRender();
            alert("INTELLIGENCE REFRESHED FROM LOCAL MEMORY.");
        });

        function loadAndRender() {
            const stored = localStorage.getItem('aura_gestalt_data');
            if (!stored) return;
            const data = JSON.parse(stored);
            processCombinator(data);
            renderTemporalGraph(data);
        }

        function renderTemporalGraph(data) {
            const graphContainer = document.getElementById('temporal-graph');
            if (!data || data.length === 0) {
                graphContainer.innerHTML = '<div style="color:#666;">// NO TEMPORAL DATA //</div>';
                return;
            }

            // 1. Parse Dates
            const dates = data.map(d => new Date(d.timestamp));
            const minDate = new Date(Math.min(...dates));
            const maxDate = new Date(Math.max(...dates));

            // Normalize to midnight
            minDate.setHours(0, 0, 0, 0);
            maxDate.setHours(0, 0, 0, 0);

            // 2. Generate Day Buckets
            const dayMap = new Map();
            const oneDay = 24 * 60 * 60 * 1000;
            const totalDays = Math.round(Math.abs((maxDate - minDate) / oneDay)) + 1;

            for (let i = 0; i < totalDays; i++) {
                const d = new Date(minDate.getTime() + (i * oneDay));
                const key = d.toISOString().split('T')[0];
                dayMap.set(key, 0);
            }

            // 3. Fill Buckets
            let maxCount = 0;
            data.forEach(item => {
                const key = new Date(item.timestamp).toISOString().split('T')[0];
                if (dayMap.has(key)) {
                    const count = dayMap.get(key) + 1;
                    dayMap.set(key, count);
                    if (count > maxCount) maxCount = count;
                }
            });

            // 4. Render
            graphContainer.innerHTML = Array.from(dayMap.entries()).map(([date, count]) => {
                const height = maxCount > 0 ? (count / maxCount) * 100 : 0;
                const isGap = count === 0;

                // Color Logic
                let bg = '#111';
                if (isGap) {
                    return `<div class="t-block t-gap" style="height: 100%;" data-date="${date}" data-count="MISSING"></div>`;
                } else {
                    // Green intensity
                    const intensity = Math.max(20, (count / maxCount) * 255);
                    bg = `rgb(0, ${intensity}, 0)`;
                    return `<div class="t-block" style="height: ${Math.max(10, height)}%; background: ${bg};" data-date="${date}" data-count="${count}"></div>`;
                }
            }).join('');
        }

        function processCombinator(data) {
            // 1. Aggregate Assets
            const assetMap = {};
            let globalGreed = 0;
            let globalFear = 0;
            let globalIq = 0;
            let globalSchizo = 0;
            let globalShill = 0;

            // Normalization Map
            const ALIASES = {
                'BITCOIN (BTC)': 'BITCOIN',
                'BTC': 'BITCOIN',
                'ETHEREUM (ETH)': 'ETHEREUM',
                'ETH': 'ETHEREUM',
                'CHAINLINK (LINK)': 'CHAINLINK',
                'LINK (CHAINLINK)': 'CHAINLINK',
                'LINK': 'CHAINLINK',
                'SOLANA (SOL)': 'SOLANA',
                'SOL': 'SOLANA',
                'RIPPLE (XRP)': 'XRP',
                'RIPPLE': 'XRP',
                'DOGECOIN (DOGE)': 'DOGECOIN',
                'DOGE': 'DOGECOIN',
                'CRYPTO (GENERAL)': 'CRYPTO MARKET',
                'THE CRYPTO MARKET': 'CRYPTO MARKET',
                'THE MARKET': 'CRYPTO MARKET',
                'CRYPTO': 'CRYPTO MARKET'
            };

            function normalize(name) {
                const upper = name.toUpperCase().trim();
                return ALIASES[upper] || upper;
            }

            data.forEach(item => {
                // Global Metrics
                globalGreed += item.radar.GREED || 0;
                globalFear += item.radar.FEAR || 0;
                globalIq += item.radar.IQ || 0;
                globalSchizo += item.radar.SCHIZO || 0;
                globalShill += item.radar.SHILL || 0;

                // Asset Aggregation
                if (item.assets) {
                    item.assets.forEach(asset => {
                        const key = normalize(asset.name);
                        if (!assetMap[key]) {
                            assetMap[key] = {
                                name: key,
                                count: 0,
                                sentimentScore: 0, // Bullish +1, Bearish -1, Neutral 0
                                narratives: []
                            };
                        }
                        assetMap[key].count++;
                        if (asset.sentiment === 'BULLISH') assetMap[key].sentimentScore += 1;
                        if (asset.sentiment === 'BEARISH') assetMap[key].sentimentScore -= 1;

                        // Store narrative with sentiment for dialectical grouping
                        assetMap[key].narratives.push({
                            text: asset.narrative,
                            sentiment: asset.sentiment
                        });
                    });
                }
            });

            // 2. Render Pentalectic Dialectic
            const totalCount = data.length || 1;
            const avgGreed = globalGreed / totalCount;
            const avgFear = globalFear / totalCount;

            // Calculate Tension (0 = All Fear, 100 = All Greed)
            const totalDrive = avgGreed + avgFear;
            const tension = totalDrive === 0 ? 50 : (avgGreed / totalDrive) * 100;

            dialecticFill.style.width = `${tension}%`;
            dialecticMarker.style.left = `${tension}%`;

            totalFearEl.textContent = Math.round(avgFear);
            totalGreedEl.textContent = Math.round(avgGreed);

            avgIqEl.textContent = Math.round(globalIq / totalCount);
            avgSchizoEl.textContent = Math.round(globalSchizo / totalCount);
            avgShillEl.textContent = Math.round(globalShill / totalCount);

            // 3. Render Leaderboard
            const sortedAssets = Object.values(assetMap).sort((a, b) => b.count - a.count);

            leaderboardBody.innerHTML = sortedAssets.map((asset, index) => {
                // Dialectical Logic: Group by Sentiment (Thesis vs Antithesis)
                const bullishNarratives = [];
                const bearishNarratives = [];
                let bullishCount = 0;
                let bearishCount = 0;

                // 1. Group Narratives & Counts
                asset.narratives.forEach(nItem => {
                    if (nItem.sentiment === 'BULLISH') {
                        bullishCount++;
                        bullishNarratives.push(nItem.text);
                    } else if (nItem.sentiment === 'BEARISH') {
                        bearishCount++;
                        bearishNarratives.push(nItem.text);
                    }
                    // Neutral is ignored for the dialectic binary
                });

                // 2. Determine Thesis (Dominant) vs Antithesis (Counter)
                let thesis, antithesis;
                let thesisCount, antithesisCount;
                let thesisType, antithesisType;

                if (bullishCount >= bearishCount) {
                    thesisType = 'BULLISH';
                    thesisCount = bullishCount;
                    thesis = getMostFrequent(bullishNarratives) || "MARKET IS OPTIMISTIC";

                    antithesisType = 'BEARISH';
                    antithesisCount = bearishCount;
                    antithesis = getMostFrequent(bearishNarratives);
                } else {
                    thesisType = 'BEARISH';
                    thesisCount = bearishCount;
                    thesis = getMostFrequent(bearishNarratives) || "MARKET IS PESSIMISTIC";

                    antithesisType = 'BULLISH';
                    antithesisCount = bullishCount;
                    antithesis = getMostFrequent(bullishNarratives);
                }

                // Helper to find most frequent string in array
                function getMostFrequent(arr) {
                    if (arr.length === 0) return null;
                    const counts = {};
                    let max = 0;
                    let res = arr[0];
                    arr.forEach(s => {
                        counts[s] = (counts[s] || 0) + 1;
                        if (counts[s] > max) {
                            max = counts[s];
                            res = s;
                        }
                    });
                    return res;
                }

                // 3. Calculate Intensity
                const totalDialectic = thesisCount + antithesisCount || 1;
                const thesisIntensity = Math.round((thesisCount / totalDialectic) * 100);
                const antithesisIntensity = Math.round((antithesisCount / totalDialectic) * 100);

                // Colors
                const thesisColor = thesisType === 'BULLISH' ? 'var(--c-greed)' : 'var(--c-fear)';
                const antithesisColor = antithesisType === 'BULLISH' ? 'var(--c-greed)' : 'var(--c-fear)';

                return `
                    <tr>
                        <td class="rank-col">${index + 1}</td>
                        <td class="asset-col">
                            <div style="font-size: 1.2em;">${asset.name}</div>
                            <div style="font-size: 0.8em; color: #666;">MENTIONS: ${asset.count}</div>
                        </td>
                        <td class="thesis-col">
                            <div class="d-score" style="color: ${thesisColor};">${thesisIntensity}%</div>
                            <div class="d-text">"${thesis}"</div>
                        </td>
                        <td class="antithesis-col">
                            ${antithesis ? `
                                <div class="d-score" style="color: ${antithesisColor};">${antithesisIntensity}%</div>
                                <div class="d-text">"${antithesis}"</div>
                            ` : '<div class="d-text" style="opacity:0.3;">[NO CONTRADICTION FOUND]</div>'}
                        </td>
                    </tr>
                `;
            }).join('');

            // 4. Render Heatmap
            heatmapContainer.innerHTML = sortedAssets.map(asset => {
                // Color based on avg sentiment
                const avgSent = asset.sentimentScore / asset.count; // -1 to 1
                let color = '#888'; // Neutral
                if (avgSent > 0.2) color = 'var(--c-greed)';
                if (avgSent < -0.2) color = 'var(--c-fear)';

                return `
                    <div class="heatmap-cell" style="background-color: ${color}40; border-color: ${color};" title="${asset.name}: ${avgSent.toFixed(2)}">
                        ${asset.name}
                    </div>
                `;
            }).join('');
        }
    </script>
</body>

</html>