<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA FARMERÂ® - Sentiment Analysis</title>
    <link rel="stylesheet" href="style.css">
    </div>
    </div>

    <script>
        // DOM Elements
        const fileInput = document.getElementById('uplink-file');
        const clearBtn = document.getElementById('clear-btn');
        const statusDisplay = document.getElementById('status-display');
        const feedContainer = document.getElementById('feed-container');

        // Load data on startup
        window.addEventListener('DOMContentLoaded', () => {
            loadFromMemory();
        });

        // Handle File Import
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    saveToMemory(data);
                    renderFeed(data);
                    statusDisplay.textContent = `[+] UPLINK SUCCESSFUL. ${data.length} RECORDS LOADED.`;
                    statusDisplay.style.color = '#0f0';
                } catch (err) {
                    statusDisplay.textContent = `[!] UPLINK FAILED: CORRUPT DATA.`;
                    statusDisplay.style.color = '#f00';
                    console.error(err);
                }
            };
            reader.readAsText(file);
        });

        // Handle Clear
        clearBtn.addEventListener('click', () => {
            if (confirm('CONFIRM PURGE? THIS CANNOT BE UNDONE.')) {
                localStorage.removeItem('aura_gestalt_data');
                renderFeed([]);
                statusDisplay.textContent = '[!] MEMORY PURGED.';
                statusDisplay.style.color = '#f00';
            }
        });

        // Local Storage Helpers
        function saveToMemory(data) {
            localStorage.setItem('aura_gestalt_data', JSON.stringify(data));
        }

        function loadFromMemory() {
            const stored = localStorage.getItem('aura_gestalt_data');
            if (stored) {
                const data = JSON.parse(stored);
                renderFeed(data);
                statusDisplay.textContent = `[+] MEMORY RESTORED. ${data.length} RECORDS ACTIVE.`;
            }
        }

        // Render Logic
        function renderFeed(data) {
            feedContainer.innerHTML = '';

            if (data.length === 0) {
                feedContainer.innerHTML = '<div class="output" style="text-align: center; opacity: 0.5;">// NO SIGNAL //</div>';
                return;
            }

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'gestalt-card';

                // Generate Radar Chart SVG
                const radarSVG = generateRadarChart(item.radar);

                card.innerHTML = `
                    <div class="gestalt-header">
                        <span class="gestalt-id">ID: ${item.id}</span>
                        <span class="gestalt-time">${new Date(item.timestamp).toLocaleTimeString()}</span>
                    </div>
                    <div class="gestalt-content">
                        <div class="gestalt-text">
                            <div class="gestalt-subject">${item.subject}</div>
                            <div class="gestalt-body">${item.gestalt_summary}</div>
                            <div class="keywords">
                                ${item.keywords.map(k => `<span class="keyword-tag">[${k}]</span>`).join('')}
                            </div>
                        </div>
                        <div class="gestalt-radar">
                            ${radarSVG}
                        </div>
                    </div>
                `;
                feedContainer.appendChild(card);
            });
        }

        function generateRadarChart(metrics) {
            // Metrics: GREED, FEAR, SCHIZO, IQ, SHILL
            const size = 120;
            const center = size / 2;
            const radius = 40;
            const keys = ['GREED', 'FEAR', 'SCHIZO', 'IQ', 'SHILL'];

            // Calculate points
            const points = keys.map((key, i) => {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2; // Start at top
                const value = (metrics[key] || 0) / 100; // Normalize 0-1
                const r = value * radius;
                const x = center + r * Math.cos(angle);
                const y = center + r * Math.sin(angle);
                return `${x},${y}`;
            }).join(' ');

            // Calculate label positions (slightly outside radius)
            const labels = keys.map((key, i) => {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const r = radius + 15;
                const x = center + r * Math.cos(angle);
                const y = center + r * Math.sin(angle);

                // Adjust text anchor based on position
                let anchor = 'middle';
                if (x < center - 10) anchor = 'end';
                if (x > center + 10) anchor = 'start';

                return `<text x="${x}" y="${y}" text-anchor="${anchor}" fill="#0f0" font-size="8" font-family="monospace">${key}</text>`;
            }).join('');

            return `
                <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                    <!-- Background Pentagon -->
                    <polygon points="${getPentagonPoints(center, radius)}" fill="rgba(0, 255, 0, 0.05)" stroke="#0f0" stroke-width="0.5" />
                    <!-- Data Polygon -->
                    <polygon points="${points}" fill="rgba(255, 0, 255, 0.3)" stroke="#f0f" stroke-width="1.5" />
                    <!-- Labels -->
                    ${labels}
                </svg>
            `;
        }

        function getPentagonPoints(center, radius) {
            const points = [];
            for (let i = 0; i < 5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const x = center + radius * Math.cos(angle);
                const y = center + radius * Math.sin(angle);
                points.push(`${x},${y}`);
            }
            return points.join(' ');
        }
    </script>
    </body>

</html>